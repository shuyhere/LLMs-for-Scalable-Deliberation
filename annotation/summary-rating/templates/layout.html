<div class="row">
  <div class="col-md-12">
    <div class="row">
      <!-- Two-column layout: instance on left, schema on right -->
      <div class="col-md-6">
        <div name="context_text" class="instance">
          <div id="instance-text" name="instance_text" style="max-width:100%; font-size: 14px;">
            {{instance | safe}}
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="annotation_schemas" style="display: flex; flex-direction: column; gap: 8px; font-size: 14px; max-width:100%;">
          {{annotation_schematic}}
        </div>
        
        <!-- Instructions for highlighting text -->
        <div id="highlight-instructions" class="highlight-instructions" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 2px solid #3949ab; display: none;">
          <h5 style="color: #3949ab; font-weight: 600;">Highlighting Instructions:</h5>
          <ol style="margin-bottom: 0; padding-left: 20px;">
            <li>Click a highlight button above to select a category</li>
            <li>Select text in the left panel to apply the highlight</li>
            <li>To remove a highlight, click on the already highlighted text</li>
            <li>The text is scrollable</li>
          </ol>
        </div>
      </div>
    </div>

    <script>
      // Script to dynamically show/hide forms based on instance type (robust to CSV text changes)
      document.addEventListener('DOMContentLoaded', function() {
        const instanceText = document.getElementById('instance-text');
        const instanceIdInput = document.getElementById('instance_id');
        if (instanceText) {
          const forms = document.querySelectorAll('.annotation_schemas form');
          console.log('Forms found:', forms.length);

          const textContent = instanceText.textContent || '';
          const instanceId = instanceIdInput ? (instanceIdInput.value || '') : '';

          // Prefer instance_id-based routing
          if (instanceId.includes('_question')) {
            console.log('Question page (by id): showing only text input form');
            for (let i = 1; i < forms.length && i <= 8; i++) {
              if (forms[i]) {
                forms[i].style.display = 'none';
                forms[i].remove();
              }
            }
          } else if (instanceId.includes('_rating')) {
            console.log('Rating page (by id): showing rating forms (1-4)');
            if (forms[0]) {
              forms[0].style.display = 'none';
              forms[0].remove();
            }
            for (let i = 5; i < forms.length && i <= 8; i++) {
              if (forms[i]) {
                forms[i].style.display = 'none';
                forms[i].remove();
              }
            }
          } else if (instanceId.includes('_comparison')) {
            console.log('Comparison page (by id): showing comparison forms (5-8)');
            if (forms[0]) {
              forms[0].style.display = 'none';
              forms[0].remove();
            }
            for (let i = 1; i <= 4 && i < forms.length; i++) {
              if (forms[i]) {
                forms[i].style.display = 'none';
                forms[i].remove();
              }
            }
          } else {
            // Fallback to text-based detection for backward compatibility
            if (textContent.includes('[Question]')) {
              console.log('Question page (by text): showing only text input form');
              for (let i = 1; i < forms.length && i <= 8; i++) {
                if (forms[i]) {
                  forms[i].style.display = 'none';
                  forms[i].remove();
                }
              }
            } else if (textContent.includes('Below is a summary of people\'s opinions on the issue')) {
              console.log('Rating page (by text): showing rating forms (1-4)');
              if (forms[0]) {
                forms[0].style.display = 'none';
                forms[0].remove();
              }
              for (let i = 5; i < forms.length && i <= 8; i++) {
                if (forms[i]) {
                  forms[i].style.display = 'none';
                  forms[i].remove();
                }
              }
            } else if (textContent.includes('Below are two summaries of people\'s opinions on the issue') || textContent.includes('Two summaries of opinions are shown below')) {
              console.log('Comparison page (by text): showing comparison forms (5-8)');
              if (forms[0]) {
                forms[0].style.display = 'none';
                forms[0].remove();
              }
              for (let i = 1; i <= 4 && i < forms.length; i++) {
                if (forms[i]) {
                  forms[i].style.display = 'none';
                  forms[i].remove();
                }
              }
            }
          }

          // Show highlighting instructions if any span annotation schema exists
          const spanInputs = document.querySelectorAll('input[for_span="True"]');
          const highlightInstructions = document.getElementById('highlight-instructions');
          if (spanInputs.length > 0 && highlightInstructions) {
            console.log('Span annotation found, showing highlighting instructions');
            highlightInstructions.style.display = 'block';
          }
        }
      });
    </script>

    <div style="height: 15px;" />

  </div>
</div>